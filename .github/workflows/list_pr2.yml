name: List Merged PRs for Release

on:
  pull_request:
    types: [opened, synchronize]
    branches:
      - main

jobs:
  list-merged-prs:
    if: startsWith(github.head_ref, 'develop')
    runs-on: ubuntu-latest
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: GitHub CLI ã®èªè¨¼
        run: echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

      - name: PRã‚’ãƒªã‚¹ãƒˆ
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          headRef=${{ github.head_ref }}
          echo "ğŸ” Checking merged PRs into $headRef ..."
          
          # Merged PRsã®å–å¾—
          prs=$(gh pr list --base "$headRef" --state merged --json number,title,url --limit 100)

          # JSONãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ãªã„ã‹ç¢ºèª
          if [[ -z "$prs" || "$prs" == "[]" ]]; then
            echo "âš ï¸ No merged PRs found for this release branch."
            exit 0
          fi

          # PRãƒªã‚¹ãƒˆã‚’ãƒ­ã‚°ã«å‡ºåŠ›
          echo "âœ… Merged PRs:"
          echo "$prs" | jq -r '.[] | "- [#" + (.number | tostring) + "](" + .url + ") " + .title'

          # Actionsã®å‡ºåŠ›ã«ã‚‚ä¿å­˜ï¼ˆä»–ã®ã‚¸ãƒ§ãƒ–ã§ä½¿ã†å ´åˆï¼‰
          echo "merged_prs<<EOF" >> $GITHUB_ENV
          echo "$prs" | jq -r '.[] | "- [#" + (.number | tostring) + "](" + .url + ") " + .title' >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV
